<html>
<head>
<script src="jquery.js"></script>
<script src="URI.js"></script>
<script>
var uri = new URI(window.location);
var MO = uri.search(true)["MO"];
var op = uri.search(true)["opnum"];

function showStartup(){
  $("#login").show();
  $("#working").hide();
}

function hideStartup(){
  $("#login").hide();
  $("#working").show();
}

function updateCount(newCount){
  $("#count").text(newCount);
}
var PPH = 0.0

$(document).ready(function(){
  showStartup();

  $( "#start" ).submit(function(event) {
    event.preventDefault();
    var emp = $(this).find("input[name='Employee']").val();
    var crw = $(this).find("input[name='CrewSize']").val();
    var socketAddress = "ws://"+location.hostname+":"+location.port+"/job?"
                        +$.param({MO: MO, opnum: op, empl: emp, crew: crw});

    //Startup the websocket. The first message will be the expected session PPH
    var webSocket = new WebSocket(socketAddress);
    webSocket.onmessage = function (event) {
      PPH = event.data
      hideStartup();
      //After the first message, all input is new count values
      webSocket.onmessage = function (event) { updateCount(event.data); }
    };
    webSocket.onclose = function(event) {
      showStartup();
      alert("Connection Failure");
    }
    $("#Part").click(function(){ webSocket.send("1") });
  });
});
// webSocket heartbeat
</script>
</head>
<body>

<div id="login">
  <form id="start">
    <input type="text" name="Employee" placeholder="Employee Number">
    <input type="text" name="CrewSize" placeholder="Crew Size">
    <input type="submit" value="Enter">
  </form>
</div>

<div id="working">
  <div id="count">0</div>
  <button id="Part">Part</button><br>
</div>

</body>
</html>

