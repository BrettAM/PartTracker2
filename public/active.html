<html>
<head>
<script src="jquery.js"></script>
<script>
function populateMoTable(MOnumber) {
  $.get("mo", {MO: MOnumber}, function(data){
    console.log(data);
    if(data == "") {
      alert("MO does not exist");
      return;
    }

    // clear all but the first row of the table
    $("#operations").find("tr:gt(0)").remove()

    // Fill the table with this MO's data
    var ops = JSON.parse(data);
    var table = $('#operations').find('tbody');
    for(var i = 0; i < ops.length; i++){
      var op = ops[i]
      var workButton = $('<button/>',{
        text: 'Work',
        click: function () { workRedirect(MOnumber, op.number) }
      });

      table.append($('<tr>')
        .append($('<td>').append(op.number))
        .append($('<td>').append(op.department))
        .append($('<td>').append(op.PPH))
        .append($('<td>').append(op.partsCompleted))
        .append($('<td>').append(op.truePPH))
        .append($('<td>').append(workButton))
      );
    }

    //Make a row at the bottom with fields for registering operations
    var opNumber = $("<input type=\"text\"/>");
    var department = $("<input type=\"text\"/>");
    var partPerHour = $("<input type=\"text\"/>");
    var newOpButton = $('<button/>',{
      text: "Register",
      click: function () {
        registerNewOperation(
          MOnumber,
          opNumber.val(),
          department.val(),
          partPerHour.val()
        );
      }
    });
    table.append($('<tr>')
      .append($('<td>').append(opNumber))
      .append($('<td>').append(department))
      .append($('<td>').append(partPerHour))
      .append($('<td>'))
      .append($('<td>'))
      .append($('<td>').append(newOpButton))
    );
  });
}
$(document).ready(function(){
  $("#Sessions").hide();

  $.get("active", function(data){
    // clear all but the first row of the table
    $("#Sessions").find("tr:gt(0)").remove()

    // Fill the table with this MO's data
    var sessions = JSON.parse(data);
    var table = $('#Sessions').find('tbody');
    for(var i = 0; i < sessions.length; i++){
      var s = sessions[i];

      var startDate = new Date(s.StartTime);
      var dateString = startDate.toLocaleString('en-US',
        { hour: 'numeric', hour12: true, minute: "2-digit" });
      //startDate.getHours()+":"+startDate.getMinutes();
      var elapsed = s.ElapsedTime;
      function hours(ms) {   return (((ms / 1000) / 60) / 60); };
      function minutes(ms) { return (( ms / 1000) / 60) % 60; };
      var elapsedString = hours(elapsed).toFixed(0)+" hrs, "+
                          minutes(elapsed).toFixed(0)+" min";

      table.append($('<tr>')
        .append($('<td>').append(s.MO))
        .append($('<td>').append(s.opnum))
        .append($('<td>').append(s.Employee))
        .append($('<td>').append(s.crewSize))
        .append($('<td>').append(dateString))
        .append($('<td>').append(elapsedString))
        .append($('<td>').append(s.count))
        .append($('<td>').append(s.ExpectedPPH.toFixed(2)))
        .append($('<td>').append(s.ActualPPH.toFixed(2)))
      );
    }

    $("#Sessions").show();
  });
});
</script>
</head>
<body>

<table style="width:100%" id="Sessions">
  <tr>
    <td>MO</td>
    <td>Op #</td>
    <td>Employee</td>
    <td>Crew Size</td>
    <td>Start Time</td>
    <td>Working Time</td>
    <td>Count</td>
    <td>Expected PPH</td>
    <td>Actual PPH</td>
  </tr>
</table>

</body>
</html>

